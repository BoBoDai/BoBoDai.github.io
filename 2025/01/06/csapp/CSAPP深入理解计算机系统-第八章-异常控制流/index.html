<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="8.0 学习ECF(异常控制流) 帮助操作系统实现I&#x2F;O、进程和虚拟内存的基本机制 应用程序通过（trap）或者（system call）的ECF形式，向操作系统进行交互 并发的基本机制 理解软件异常如何工作  8.1 异常异常就是控制流中的突变，用来响应处理器状态中的某些变化 有异常事件发生时，会通过一张异常表的跳转表，进行一个间接调用，到一个专门设计用来处理操作系统子程序。异常处理程">
<meta property="og:type" content="article">
<meta property="og:title" content="CSAPP深入理解计算机系统-第八章-异常控制流">
<meta property="og:url" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/index.html">
<meta property="og:site_name" content="Cactus Hole">
<meta property="og:description" content="8.0 学习ECF(异常控制流) 帮助操作系统实现I&#x2F;O、进程和虚拟内存的基本机制 应用程序通过（trap）或者（system call）的ECF形式，向操作系统进行交互 并发的基本机制 理解软件异常如何工作  8.1 异常异常就是控制流中的突变，用来响应处理器状态中的某些变化 有异常事件发生时，会通过一张异常表的跳转表，进行一个间接调用，到一个专门设计用来处理操作系统子程序。异常处理程">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.1.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.2.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.3.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.4.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.5.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.6.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.7.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.8.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.9.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.10.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.11.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.12.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.13.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.14.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.15.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.16.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.17.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.18.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.19.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.20.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.21.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.22.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.23.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.24.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.25.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.26.png">
<meta property="og:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.27.png">
<meta property="article:published_time" content="2025-01-06T14:12:34.000Z">
<meta property="article:modified_time" content="2025-01-08T05:24:57.524Z">
<meta property="article:author" content="BoBoDai">
<meta property="article:tag" content="计算机系统">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.1.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>CSAPP深入理解计算机系统-第八章-异常控制流</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/BoBoDai">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E4%B8%83%E7%AB%A0-%E9%93%BE%E6%8E%A5/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&text=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&is_video=false&description=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP深入理解计算机系统-第八章-异常控制流&body=Check out this article: http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&name=CSAPP深入理解计算机系统-第八章-异常控制流&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&t=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-0-%E5%AD%A6%E4%B9%A0ECF-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">1.</span> <span class="toc-text">8.0 学习ECF(异常控制流)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%BC%82%E5%B8%B8"><span class="toc-number">2.</span> <span class="toc-text">8.1 异常</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">8.1.1 异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-%E5%BC%82%E5%B8%B8%E7%9A%84%E7%B1%BB%E5%88%AB"><span class="toc-number">2.2.</span> <span class="toc-text">8.1.2 异常的类别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-1%E3%80%81%E4%B8%AD%E6%96%AD"><span class="toc-number">2.2.1.</span> <span class="toc-text">8.1.2.1、中断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-2%E3%80%81%E9%99%B7%E9%98%B1%E5%92%8C%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">8.1.2.2、陷阱和系统调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-3%E3%80%81%E6%95%85%E9%9A%9C"><span class="toc-number">2.2.3.</span> <span class="toc-text">8.1.2.3、故障</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-4%E3%80%81%E7%BB%88%E6%AD%A2"><span class="toc-number">2.2.4.</span> <span class="toc-text">8.1.2.4、终止</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-Linux%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-number">2.3.</span> <span class="toc-text">8.1.3 Linux中的异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-1-%E6%95%85%E9%9A%9C%E5%92%8C%E7%BB%88%E6%AD%A2"><span class="toc-number">2.3.1.</span> <span class="toc-text">8.1.3.1 故障和终止</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-2-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">8.1.3.2 系统调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">8.2 进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">3.0.1.</span> <span class="toc-text">8.2.1 逻辑控制流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E5%B9%B6%E5%8F%91%E6%B5%81"><span class="toc-number">3.0.2.</span> <span class="toc-text">8.2.2 并发流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-%E7%A7%81%E6%9C%89%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4"><span class="toc-number">3.0.3.</span> <span class="toc-text">8.2.3 私有地址空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-4-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%86%85%E6%A0%B8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.0.4.</span> <span class="toc-text">8.2.4 用户模式和内核模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2"><span class="toc-number">3.0.5.</span> <span class="toc-text">8.2.5 上下文切换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">8.3 系统调用错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text">8.4 进程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-1-%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8BID"><span class="toc-number">5.1.</span> <span class="toc-text">8.4.1 获取进程ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-2-%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BB%88%E6%AD%A2%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text">8.4.2 创建和终止进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-3-%E5%9B%9E%E6%94%B6%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.3.</span> <span class="toc-text">8.4.3 回收子进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-4-%E8%AE%A9%E8%BF%9B%E7%A8%8B%E4%BC%91%E7%9C%A0"><span class="toc-number">5.4.</span> <span class="toc-text">8.4.4 让进程休眠</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-5-%E5%8A%A0%E8%BD%BD%E5%B9%B6%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.5.</span> <span class="toc-text">8.4.5 加载并运行程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.</span> <span class="toc-text">8.5 信号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-1-%E4%BF%A1%E5%8F%B7%E6%9C%AF%E8%AF%AD"><span class="toc-number">6.1.</span> <span class="toc-text">8.5.1 信号术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-2-%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.</span> <span class="toc-text">8.5.2 发送信号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-1-%E8%BF%9B%E7%A8%8B%E7%BB%84"><span class="toc-number">6.2.1.</span> <span class="toc-text">8.5.2.1 进程组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-2-%E7%94%A8-bin-kill%E7%A8%8B%E5%BA%8F%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.2.</span> <span class="toc-text">8.5.2.2 用&#x2F;bin&#x2F;kill程序发送信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-3-%E4%BB%8E%E9%94%AE%E7%9B%98%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.3.</span> <span class="toc-text">8.5.2.3 从键盘发送信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-4-%E7%94%A8kill%E5%87%BD%E6%95%B0%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.4.</span> <span class="toc-text">8.5.2.4 用kill函数发送信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-5-alarm%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.5.</span> <span class="toc-text">8.5.2.5 alarm发送信号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-3-%E6%8E%A5%E6%94%B6%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.3.</span> <span class="toc-text">8.5.3 接收信号</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        CSAPP深入理解计算机系统-第八章-异常控制流
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">BoBoDai</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2025-01-06T14:12:34.000Z" class="dt-published" itemprop="datePublished">2025-01-06</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F/" rel="tag">计算机系统</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <h2 id="8-0-学习ECF-异常控制流"><a href="#8-0-学习ECF-异常控制流" class="headerlink" title="8.0 学习ECF(异常控制流)"></a>8.0 学习ECF(异常控制流)</h2><ul>
<li>帮助操作系统实现I&#x2F;O、进程和虚拟内存的基本机制</li>
<li>应用程序通过（trap）或者（system call）的ECF形式，向操作系统进行交互</li>
<li>并发的基本机制</li>
<li>理解软件异常如何工作</li>
</ul>
<h2 id="8-1-异常"><a href="#8-1-异常" class="headerlink" title="8.1 异常"></a>8.1 异常</h2><p>异常就是控制流中的突变，用来响应处理器状态中的某些变化</p>
<p>有异常事件发生时，会通过一张异常表的跳转表，进行一个间接调用，到一个专门设计用来处理操作系统子程序。异常处理程序完成处理后，会有以下三种情况。</p>
<ul>
<li>处理程序将控制返回给当前指令，即当事件发生时正在执行的指令；</li>
<li>处理程序将控制返回给原指令，如果没有发生异常将会执行的下一跳指令；</li>
<li>处理程序终止被中断的程序。</li>
</ul>
<h3 id="8-1-1-异常处理"><a href="#8-1-1-异常处理" class="headerlink" title="8.1.1 异常处理"></a>8.1.1 异常处理</h3><p>系统启动时，操作系统分配和初始化一张异常表，包含异常的处理程序的地址。<br>当异常发生时，确定了相对应的异常号后，触发异常，通过间接过程进行调用，通过异常表的表目跳转到相对应的处理程序。</p>
<p>异常表的起始地址放在一个叫做异常表基址寄存器的特殊CPU寄存器里。<br>异常类似于过程调用，有一些不同之处。</p>
<ul>
<li>过程调用，在跳转到处理程序之前，处理器将返回地址压入栈中。然而，根据异常的类型，返回地址要么是当前指令，要么是下一条的指令。</li>
<li>处理器把额外的处理器状态压到栈里，在处理程序返回是，重新开始执行被中断的程序也会需要这些状态。</li>
<li>如果控制从用户程序转移到内核，所有这些项目都被压到内核栈中，而不是压到用户栈中。</li>
<li>异常处理程序运行在内核模式下，意味着它们对所有的资源都有完全访问权限。</li>
</ul>
<p>异常处理完成后执行重中断返回指令，回到中断程序或将控制返回到下一跳执行，或者终止程序。</p>
<h3 id="8-1-2-异常的类别"><a href="#8-1-2-异常的类别" class="headerlink" title="8.1.2 异常的类别"></a>8.1.2 异常的类别</h3><p>异常有四种</p>
<ul>
<li>中断<ul>
<li>原因：来自I&#x2F;O设备的信号</li>
<li>异步</li>
<li>总是返回到下一条指令</li>
</ul>
</li>
<li>陷阱<ul>
<li>原因：有意的异常</li>
<li>同步</li>
<li>总是返回到下一条指令</li>
</ul>
</li>
<li>故障<ul>
<li>原因：潜在可恢复的错误</li>
<li>同步</li>
<li>可能返回到当前指令</li>
</ul>
</li>
<li>终止<ul>
<li>原因：不可恢复的错误</li>
<li>同步</li>
<li>不会返回</li>
</ul>
</li>
</ul>
<p>异步异常是由处理器外部的 I&#x2F;O设备中的事件产生。同步异常是执行一条指令的直接产物。</p>
<h4 id="8-1-2-1、中断"><a href="#8-1-2-1、中断" class="headerlink" title="8.1.2.1、中断"></a>8.1.2.1、中断</h4><p>硬件中断的异常处理程序常常称为中断处理程序。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.1.png"></p>
<p>当前指令完成执行后，中断引脚的电压变高了，就从系统总线读取异常号，然后调用适当的中断处理程序。处理程序返回就执行下一条指令。</p>
<p>剩下的是同步异常，是执行当前指令的结果，也叫做故障指令。</p>
<h4 id="8-1-2-2、陷阱和系统调用"><a href="#8-1-2-2、陷阱和系统调用" class="headerlink" title="8.1.2.2、陷阱和系统调用"></a>8.1.2.2、陷阱和系统调用</h4><p>陷阱是有意的异常，陷阱处理程序将控制返回到下一条指令。陷阱更多是提供一个过程接口，叫做系统调用。</p>
<p>例如用户程序需要向内核请求服务，比如读一个文件，创建一个新的进程，加载一个新的程序，或者终止当前进程。为了允许，对这些内核的受控访问，处理器提供 syscall 指令，会进入一个陷阱，在这里处理程序解析参数，并调用适当的内核程序。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.2.png"></p>
<p>程序调用在用户模式，系统调用在内核模式中。</p>
<h4 id="8-1-2-3、故障"><a href="#8-1-2-3、故障" class="headerlink" title="8.1.2.3、故障"></a>8.1.2.3、故障</h4><p>故障由错误引起，如果处理程序能够修正，就控制返回到引起故障的指令，从而重新执行它，否则处理程序返回到内核中的 abort 例程，abort 例程会终止引起故障的应用程序。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.3.png"></p>
<p>例如缺页异常，当引用的虚拟地址，匹配的物理页面不在内存中，会发生故障，缺页处理程序从磁盘加载适当的页面，然后将控制返回引起故障的指令。当指令执行的时候页面已经在内存中了，就可以继续执行下去了。</p>
<h4 id="8-1-2-4、终止"><a href="#8-1-2-4、终止" class="headerlink" title="8.1.2.4、终止"></a>8.1.2.4、终止</h4><p>终止是不可恢复的致命错误，如DRAM或SRAM被损坏时发生的错误，处理程序不会将控制返回应用程序，而是直接返回给一个abort例程，终止这个应用程序。</p>
<h3 id="8-1-3-Linux中的异常"><a href="#8-1-3-Linux中的异常" class="headerlink" title="8.1.3 Linux中的异常"></a>8.1.3 Linux中的异常</h3><p>0～31 是Intel架构师定义的异常；</p>
<p>32～255 是操作系统中的中断和陷阱；</p>
<h4 id="8-1-3-1-故障和终止"><a href="#8-1-3-1-故障和终止" class="headerlink" title="8.1.3.1 故障和终止"></a>8.1.3.1 故障和终止</h4><ul>
<li><p>除法错误<br>除0的时候会发生除法错误（异常0）。Unix会终止程序.</p>
</li>
<li><p>一般保护故障<br>许多原因导致（异常13），通常是因为一个程序引用了未定义虚拟内存区域，或者试图写一个只读的文本段，Linux不会修复这类故障。</p>
</li>
<li><p>缺页<br>物理页没有映射到引发的故障，（异常14）</p>
</li>
<li><p>机器检查<br>机器检查（异常18）指令执行中遭遇致命硬件错误时发生的。</p>
</li>
</ul>
<h4 id="8-1-3-2-系统调用"><a href="#8-1-3-2-系统调用" class="headerlink" title="8.1.3.2 系统调用"></a>8.1.3.2 系统调用</h4><p>每个系统调用都有一个唯一的整数号，对应到内核中跳转表的偏移量，可通过syscall陷阱指令来调用。</p>
<p>系统调用的参数都是通过寄存器而不是栈传递的。</p>
<p>一般</p>
<ul>
<li>rax 包含系统调用号</li>
<li>rdi rsi rdx r10 r8 r9 包含最多6个参数</li>
</ul>
<p>系统调用返回时，寄存器 rcx 和 r11 都会被破坏，rax包含返回值。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.4.png"></p>
<p>返回 -4095 到 -1 之间的负数代表发生了错误。</p>
<h2 id="8-2-进程"><a href="#8-2-进程" class="headerlink" title="8.2 进程"></a>8.2 进程</h2><p>异常是允许系统内核提供进程概念的基本模块，是计算机科学中最深刻，最成功的概念之一。</p>
<p>现代系统运行时有一个假象</p>
<ul>
<li>程序独占的使用处理器</li>
<li>程序独占的使用内存系统</li>
</ul>
<p>程序好像是无间的一条一条执行程序中的指令，这些假象是通过进程的概念提供给我们的。</p>
<p>系统中的每个程序都运行在某个进程的上下文中。</p>
<ul>
<li>上下文是由程序正确运行所需的状态组成的。状态包括存放在内存中的代码和数据，它的栈、通用目的寄存器的内容、程序计数器、环境变量以及打开文件描述符的集合。</li>
</ul>
<p>用户向shell输入一个新的可执行文件的名字，运行程序时，shell就会创建一个新进程，然后在这个新进程的上下文中运行这个可执行目标文件。</p>
<p>进程提供给应用程序的关键抽象</p>
<ul>
<li>一个独立的逻辑控制流，它提供一个假象，好像我们的程序独占地使用处理器</li>
<li>一个私有的地址空间，它提供一个假象，好像我们的程序独占地使用内存系统。</li>
</ul>
<h4 id="8-2-1-逻辑控制流"><a href="#8-2-1-逻辑控制流" class="headerlink" title="8.2.1 逻辑控制流"></a>8.2.1 逻辑控制流</h4><p>执行程序时，程序计数器（PC）值的序列叫逻辑控制流简称逻辑流。</p>
<p>是轮流使用处理器的，执行一部分然后被挂起。</p>
<h4 id="8-2-2-并发流"><a href="#8-2-2-并发流" class="headerlink" title="8.2.2 并发流"></a>8.2.2 并发流</h4><p>一个逻辑流的执行在时间上与另一个流重叠，称为并发流，这两个流并发的运行。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.5.png"></p>
<ul>
<li>A 和 B是并发运行</li>
<li>A 和 C也是并发运行</li>
<li>B 和 C 不是，因为B已经运行结束了</li>
</ul>
<p>多个流并发的执行的一般现象被称为并发。一个进程和其他进程轮流运行称为多任务。一个进程执行它的控制流的一部分的每一时间段叫时间片。因此多任务也叫时间分片。</p>
<ul>
<li>进程A有两个时间片</li>
<li>进程B有一个时间片</li>
<li>进程C有两个时间片</li>
</ul>
<p>如果两个流并发的运行在不同的处理器核或者计算机上，那么我们称它们为并行流，并行的运行且并行的执行。</p>
<h4 id="8-2-3-私有地址空间"><a href="#8-2-3-私有地址空间" class="headerlink" title="8.2.3 私有地址空间"></a>8.2.3 私有地址空间</h4><p>每个进程好像独占的使用系统地址空间。</p>
<p>在一台n位地址的机器上，地址空间是是2^n个可能地址的集合，0，1，…，2^n-1。进程为每个程序提供它自己的私有地址空间。这个空间中某个地址关联的内存字节是不能被其他进程读或者写的，所以地址空间是私有的。</p>
<p>进程的地址空间结构相同。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.6.png"></p>
<ul>
<li>底部是用户程序的，包括通常的代码、数据、堆和栈。总是从0x400000开始。</li>
<li>地址空间顶部保留给内核（操作系统常驻内存的部分）属于用户代码不可见。</li>
</ul>
<h4 id="8-2-4-用户模式和内核模式"><a href="#8-2-4-用户模式和内核模式" class="headerlink" title="8.2.4 用户模式和内核模式"></a>8.2.4 用户模式和内核模式</h4><p>为了使操作系统内核提供一个无懈可击的进程对象，处理器限制一个应用可以执行的指令以及它可以访问的地址空间范围。</p>
<p>处理器通常是控制寄存器中的一个模式位来提供这种功能的，该寄存器描述了进程当前享有的特权。</p>
<ul>
<li>当设置了模式位时，进程就运行在内核模式中。运行在内核模式中的进程可以执行指令集中的任何指令，并且可以访问系统中的任何内存位置。</li>
<li>没有设置位置位时，进程运行在用户模式中，用户模式中的进程不允许执行特权指令，如停止处理器、改变模式位，或者发起一个I&#x2F;O操作。也不许用户模式中的进程之间引用地址空间中内核区的代码和数据。任何这种操作都会导致致命的保护故障，用户程序必须通过系统调用接口间接地访问内核代码和数据。</li>
</ul>
<p>运行应用程序代码的进程一开始是在用户模式中运行，变成内核模式的唯一方法就是中断、故障、陷入这种异常。</p>
<p>一发生异常，处理器就会从用户模式转为内核模式，处理程序运行在内核模式中，返回到应用程序代码时，处理器就把模式从内核模式改回到用户模式。</p>
<p>Linux 可以通过 &#x2F;proc文件访问内核的数据结构。</p>
<h4 id="8-2-5-上下文切换"><a href="#8-2-5-上下文切换" class="headerlink" title="8.2.5 上下文切换"></a>8.2.5 上下文切换</h4><p>内核使用上下文切换的较高层形式的异常控制流来实现多任务。</p>
<p>内核为每一个进程维护一个上下文。上下文就是内核重新启动一个被抢占的进程所需的状态。由一些对象的值组成。包含通用目的寄存器、浮点寄存器、程序计数器、用户栈、状态寄存器、内核栈和各种内核数据结构，比如描述地址空间的页表、包含有关当前进程信息的进程表，以及包含进程已打开文件的信息的文件表。</p>
<p>进程执行的某些时刻，内核可以决定抢占当前进程，并重新开始一个先前被抢占流的进程。这种决策叫做调度。由调度器处理。</p>
<p>内核新运行一个进程时会抢占当前进程，并使用上下文切换将控制转移到新进程</p>
<p>上下文切换</p>
<ul>
<li>1 保存当前进程的上下文；</li>
<li>2 恢复某个先前被抢占的进程被保存的上下文；</li>
<li>3 将控制传递给这个新恢复的进程。</li>
</ul>
<p>内核代表用户执行系统调用时，可能会发生上下文切换，如果系统调用因为等待某个事件发生而阻塞，内核可以让当前进程休眠，切换到另一个进程。</p>
<p>如果一个read系统调用需要访问的磁盘，内核可以选择执行上下文切换，运行另外一个进程，而不是等待数据从磁盘到达。</p>
<p>中断也有可能引发上下文切换。所有系统都有某种产生周期性定时器中断的机制，通常为1毫秒或10毫秒，每次定时器中断时，内核就能判定当前进程已经运行了足够长的时间，并切换到一个新进程。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.7.png"></p>
<ul>
<li>进程 A 在用户模式下执行；</li>
<li>A 需要读取数据执行read陷入到内核中，磁盘读取数据时间较长；</li>
<li>上下文切换到进程 B 在用户模式下运行；</li>
<li>磁盘发出一个中断信号，表示数据已经从磁盘传送到了内存；</li>
<li>内核判断 B 运行时间足够长；</li>
<li>就上下文切换到 A ，继续执行。</li>
</ul>
<h2 id="8-3-系统调用错误处理"><a href="#8-3-系统调用错误处理" class="headerlink" title="8.3 系统调用错误处理"></a>8.3 系统调用错误处理</h2><p>错误检查让代码臃肿难读<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.8.png"></p>
<p>可以一定程度上包装一个函数来简化这一切<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.9.png"></p>
<p>这样调用变为<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.10.png"></p>
<p>通过使用错误处理包装函数，可以进一步简化代码。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.11.png"></p>
<p>给定这个包装函数，堆fork的调用为<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.12.png"></p>
<h2 id="8-4-进程控制"><a href="#8-4-进程控制" class="headerlink" title="8.4 进程控制"></a>8.4 进程控制</h2><h3 id="8-4-1-获取进程ID"><a href="#8-4-1-获取进程ID" class="headerlink" title="8.4.1 获取进程ID"></a>8.4.1 获取进程ID</h3><p>每个进程都有一个唯一的正数（非0）进程ID。</p>
<p>getpid函数返回调用进程的PID。</p>
<p>getpid函数返回它的父进程的PID</p>
<p>getpid 和 getppid 函数返回一个类型为pid_t的整数值，在Linux系统上它在types.h中被定义为int。</p>
<h3 id="8-4-2-创建和终止进程"><a href="#8-4-2-创建和终止进程" class="headerlink" title="8.4.2 创建和终止进程"></a>8.4.2 创建和终止进程</h3><p>程序员的角度，进程处于下面三种状态之一。</p>
<ul>
<li>运行，进程要么在CPU上执行，要么在等待执行并最终会被调度。</li>
<li>停止，进程的执行被挂起，且不会被调度。当收到SIGSTOP、SIGTSTP、SIGTTIN或者SIGTTOU信号时，进程就会停止，且保持停止直到它收到一个SIGCONT信号，在这个时刻，进程再次开始运行。</li>
<li>终止，进程永远的终止了，进程会因为三种原因终止：<ul>
<li>收到一个信号，该信号的默认行为是终止进程；</li>
<li>从主程序返回</li>
<li>调用exit函数。</li>
</ul>
</li>
</ul>
<p>exit函数以status退出状态来终止进程，另一种退出状态的方法是从主程序中返回整数值。</p>
<p>父进程通过调用fork函数创建一个新的运行的子进程。</p>
<ul>
<li>子进程与父进程用户级虚拟地址空间相同，是一份独立的副本，包含代码数据段、堆、共享库以及用户栈；</li>
<li>子进程还获得与父进程中打开堆任何文件，父进程和新创建的子进程有两个不同的PID。</li>
</ul>
<p>如</p>
<p><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.13.png"></p>
<p>上面的例子会创建一个子进程。</p>
<ul>
<li><p>调用一次，返回两次。<br>一次是返回到父进程，一次是返回到新创建的子进程</p>
</li>
<li><p>并发执行。<br>父进程和子进程是并发运行的独立进程。内核能够以任意方式交替执行逻辑控制流中的指令</p>
</li>
<li><p>相同但是独立的地址空间。<br>能够在fork函数在父进程和子进程中返回后理解暂停这两个进程，会看到两个进程的地址空间都是相同的。每个进程都有相同的用户栈、相同的本地变量值、相同的堆、相同的全局变量值，以及相同的代码。本地变量x在父子进程的私有地址空间里的任何改变都是独立的，不会反应在另一个进程的内存中。</p>
</li>
<li><p>共享文件。<br>父进程和子进程都把它们的输出显示在屏幕上，子进程继承里父进程所有的打开文件。当父进程调用fork时，stdout文件是打开的，并指向屏幕，子进程继承了这个文件，所以输出也是指向屏幕的。</p>
</li>
</ul>
<h3 id="8-4-3-回收子进程"><a href="#8-4-3-回收子进程" class="headerlink" title="8.4.3 回收子进程"></a>8.4.3 回收子进程</h3><p>当一个进程终止时，内核不会立即清楚它，而是保持在一种已终止的状态中，直到被父进程回收。当父进程回收已终止的子进程时，内核将子进程的退出状态传递给父进程，然后抛弃已经终止的进程，从此时开始，该进程就不存在了。一个终止了但未被回收的进程称为僵死进程。</p>
<p>当一个父进程终止了，内核会安排init进程称为它的孤儿进程的养父。init进程的PID为1，是系统启动时由内核创建的，不会终止，是所有进程的祖先。而后由init进程去回收它们。</p>
<p>进程可以通过调用<code>waitpid</code>函数来等待它的子进程终止或停止。</p>
<p>如果等待集合中的一个进程在刚调用的时刻就已经终止了，那么waitpid就立即返回，内核会删除它的所有痕迹。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.14.png"></p>
<ul>
<li><p>1.判定等待集合的成员</p>
<ul>
<li>等待集合的成员是由参数pid来确定的：</li>
<li>如果pid&gt;0，那么等待集合就是一个单独的子进程，它的进程ID等于pid</li>
<li>如果pid&#x3D;-1那么等待集合就是由父进程所有的子进程组成。</li>
</ul>
</li>
<li><p>修改默认行为</p>
<p>通过将options设置为常量 WNOHANG、WUNTRACED、WCONTINUED 的各种组合来修改默认行为。</p>
<ul>
<li><p>WNOHANG<br>如果等待集合中的任何子进程都没有终止，那么就立即返回（返回0）。默认行为是挂起调用进程，直到有子进程终止。</p>
</li>
<li><p>WUNTRACED<br>挂起调用进程的执行，直到等待集合中的一个进程变成已终止或者被停止。返回的PID为导致返回的已终止或被停止的子进程PID。默认行为是只返回已终止的子进程。当你想要检查已终止和被停止的子进程时使用。</p>
</li>
<li><p>WCONTINUED<br>挂起调用进程的执行，直到等待集合中的一个正在运行的进程终止，或等待集合中一个被停止的进程收到SIGCONT信号重新开始执行。</p>
</li>
<li><p>WNOHANG ｜ WUNTRACED<br>立即返回，如果等待集合中的子进程都没有被停止或终止，则返回值为0；如果有进程停止或终止，返回中为该子进程的PID。</p>
</li>
</ul>
</li>
<li><p>检查已回收子进程的退出进程<br>如果<code>statusp</code>参数是非空的，<code>waitpid</code>就会在<code>status</code>中放上关于导致返回的子进程的状态信息，<code>status</code>是<code>statusp</code>指向的值。wait.h头文件定义了解释<code>status</code>参数的几个宏</p>
<ul>
<li><p>WIFEXITED(status)<br>如果子进程通过调用exit或者一个返回（return）正常终止，就返回真</p>
</li>
<li><p>WEXITSTATUS(status)<br>返回一个正常终止的子进程的退出状态。只有在 WIFEXITED() 返回为真时，才会定义这个状态。</p>
</li>
<li><p>WIFSIGNALED(status)<br>如果子进程是因为一个未被捕获的信号终止的，那么就返回真</p>
</li>
<li><p>WTERMSIG(status)<br>返回导致子进程终止的信号的编号。只有在 WIFSIGNALED() 返回为真时，才定义这个状态。</p>
</li>
<li><p>WIFCONTINUED(status)<br>如果子进程收到SIGCONT信号重新启动，则返回真。</p>
</li>
</ul>
</li>
<li><p>错误条件<br>如果调用进程没有子进程，那么waitpid 返回 -1，并且设置 errno 为 ECHILD。如果waitpid函数被一个信号中断，那么返回 -1， 并设置errno 为EINTR。</p>
</li>
</ul>
<h3 id="8-4-4-让进程休眠"><a href="#8-4-4-让进程休眠" class="headerlink" title="8.4.4 让进程休眠"></a>8.4.4 让进程休眠</h3><p>sleep 函数将一个进程挂起一段指定的时间</p>
<p>如果时间量已经到了，sleep返回0，否则返回还剩下要休眠的秒数。</p>
<p>pause 函数让函数休眠，直到该进程收到一个信号。</p>
<h3 id="8-4-5-加载并运行程序"><a href="#8-4-5-加载并运行程序" class="headerlink" title="8.4.5 加载并运行程序"></a>8.4.5 加载并运行程序</h3><p>execve 函数在当前进程的上下文中加载并运行一个新程序。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.15.png"></p>
<p>execve 函数加载并运行目标文件filename，并且带参数列表argv和环境变量列表envp。</p>
<p>参数列表 argv数组<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.16.png"></p>
<ul>
<li>argv[0] 是可执行目标文件的名字；</li>
<li>argv[1]表示第一个参数；</li>
<li>argc表示参数的个数。</li>
</ul>
<p>环境变量列表envp<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.17.png"></p>
<ul>
<li>包括当前的工作目录等环境变量</li>
</ul>
<p>execve加载了filename之后，调用启动代码设置栈，并将控制传递给新程序的主函数，指向数组中的第一个元素<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.18.png"></p>
<p>当main开始执行时，用户栈的组织结构如下。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.19.png"></p>
<ul>
<li>main 由libc_start_main调用，所以main在低地址。</li>
</ul>
<h2 id="8-5-信号"><a href="#8-5-信号" class="headerlink" title="8.5 信号"></a>8.5 信号</h2><p>信号就是一条小消息，通知进程系统中发生率某种类型的事件，运行内核或进程可以中断其他进程。</p>
<p>正常情况下异常由内核处理，用户程序不可见，通过信号可以通知进程发生了什么异常情况。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.20.png"></p>
<h3 id="8-5-1-信号术语"><a href="#8-5-1-信号术语" class="headerlink" title="8.5.1 信号术语"></a>8.5.1 信号术语</h3><p>传送一个信号到目的进程是由灵感不同的步骤组成</p>
<ul>
<li><p>发送信号<br>内核检测到一个系统事件，或是调用了kill函数，显式的要求内核发送一个信号给目的进程。一个进程可以发送信号给它自己。</p>
</li>
<li><p>接收信号<br>目的进程被内核强迫以某种方式对信号的发送做出反应，它就接收了信号。进程可以忽略这个信号，终止或者通过执行一个称为<code>信号处理程序</code>的用户层函数捕获这个信号。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.21.png"></p>
</li>
</ul>
<p>信号处理。接收到信号会触发控制转移到信号处理程序。在信号处理程序完成处理后，它将控制返回给被中断的程序。</p>
<p>发出而没被接收的信号叫待处理信号。任何时刻，一种类型最多只会有一个待处理信号。如果一个进程有一个k类型的待处理信号，接下来接收的任何k类型的信号都会被丢弃。</p>
<p>一个进程可以有选择的阻塞接收某种信号，当一种信号被阻塞时，它仍可以被发送，但是产生的待处理信号不会被接收，直到进程取消对这种信号的阻塞。</p>
<p>一个待处理信号最多被接收一次，内核在pading位向量中维护着待处理信号的集合，而在blocked位向量中维护着被阻塞的信号集合。只要传送了一个类型位k的信号，内核就会设置pending中的第 k 位，而只要接收了一个类型为 k 的信号，内核就会清除 pending 中的第 k 位。</p>
<h3 id="8-5-2-发送信号"><a href="#8-5-2-发送信号" class="headerlink" title="8.5.2 发送信号"></a>8.5.2 发送信号</h3><p>发送信号的机制是机遇进程组实现的。</p>
<h4 id="8-5-2-1-进程组"><a href="#8-5-2-1-进程组" class="headerlink" title="8.5.2.1 进程组"></a>8.5.2.1 进程组</h4><p>每个进程都只属于一个进程组，进程组是由一个正整数进程组ID来标识的。</p>
<p>getpgrp函数返回当前进程的进程组ID<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.22.png"></p>
<p>可以通过 setpgid 函数改变自己或者其他进程的进程组。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.23.png"></p>
<p>setpgid函数将进程pid的进程组改为pgid。如果pid是0，那么就使用当前进程的pid。如果pgid是0，那么就用pid指定的进程的PID作为进程组ID。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">例如进程15213调用进程</span><br><span class="line">setpgid(0, 0)</span><br><span class="line">会创建一个新的进程组，其进程组ID是15213，并且把进程15213加入到这个新进程组中。</span><br></pre></td></tr></table></figure>

<h4 id="8-5-2-2-用-bin-kill程序发送信号"><a href="#8-5-2-2-用-bin-kill程序发送信号" class="headerlink" title="8.5.2.2 用&#x2F;bin&#x2F;kill程序发送信号"></a>8.5.2.2 用&#x2F;bin&#x2F;kill程序发送信号</h4><p>kill指令可以向另外的进程发送任意的信号。</p>
<p><code>/bin/kill -9 -15213</code>发送了一个SIGKILL信号给进程组15213中的每个进程</p>
<h4 id="8-5-2-3-从键盘发送信号"><a href="#8-5-2-3-从键盘发送信号" class="headerlink" title="8.5.2.3 从键盘发送信号"></a>8.5.2.3 从键盘发送信号</h4><p>shell 使用job概念表示对一条命令行求值而创建的进程。在任何时刻，最多有一个前台作业，0或多个后台作业。</p>
<p>输入<code>Ctrl + C</code>发送一个SIGINT信号到前台进程组中的每一个进程。</p>
<p>输入<code>Ctrl + Z</code>发送一个SIGSTP信号到前台进程组中的每一个进程，会挂起前台作业。</p>
<p><code>ls | sort</code>会创建由两个进程组合的前台作业，一个运行ls程序，一个运行sort程序，</p>
<p>ls的结果通过管道符成为sort的输入。</p>
<p>shell为每个作业创建了独立的进程组。进程组ID通常取自作业中父进程的一个<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.24.png"></p>
<h4 id="8-5-2-4-用kill函数发送信号"><a href="#8-5-2-4-用kill函数发送信号" class="headerlink" title="8.5.2.4 用kill函数发送信号"></a>8.5.2.4 用kill函数发送信号</h4><p>可以通过调用函数kill向其他进程发送信号（包括自己）。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.25.png"></p>
<ul>
<li>pid 大于0，函数发送信号给进程pid</li>
<li>pid 等于0，很少发送信号给调用进程所在组的所有进程，包括自己</li>
<li>pid小于0，kill发送信号sig给进程组 ｜pid｜（pid的绝对值）中的每个进程。</li>
</ul>
<h4 id="8-5-2-5-alarm发送信号"><a href="#8-5-2-5-alarm发送信号" class="headerlink" title="8.5.2.5 alarm发送信号"></a>8.5.2.5 alarm发送信号</h4><p>进程可以通过调用alarm函数向自己发送 SIGALRM信号<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.26.png"></p>
<p>alarm 函数安排内核在 secs 秒后发送一个 AIGALRM 信号给调用进程。</p>
<p>如果secs是0那么就不会调度安排新的alarm。</p>
<p>对alarm的调用都将取消任何待处理的alarm，并返回任何待处理alarm在被发送前还剩下的秒数，如果没有alarm就返回0。</p>
<h3 id="8-5-3-接收信号"><a href="#8-5-3-接收信号" class="headerlink" title="8.5.3 接收信号"></a>8.5.3 接收信号</h3><p>当内核把进程切换到用户模式时，会检查进程的未被阻塞的待处理信号的集合，如果集合为空，那么内核将控制传递到逻辑控制流中的下一条指令。如果集合是非空的，那么内核选择集合中某个信号k（一般是最小的），并强制进程接收信号k。接收到这个信号会采取一定行为，完成后控制就传递回进程的逻辑控制流中的下一条指令。每个信号都有一个预定义的默认行为。</p>
<ul>
<li>进程终止；</li>
<li>进程终止并转储内存（把代码和数据写到磁盘上）；</li>
<li>进程停止（挂起）直到被SIGCONT信号重庆；</li>
<li>进程忽略该信号（SIGCHLD）</li>
</ul>
<p>信号处理程序可以被其他信号中断。<br><img src="/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/8.27.png"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/BoBoDai">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-0-%E5%AD%A6%E4%B9%A0ECF-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">1.</span> <span class="toc-text">8.0 学习ECF(异常控制流)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%BC%82%E5%B8%B8"><span class="toc-number">2.</span> <span class="toc-text">8.1 异常</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-1-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">8.1.1 异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-2-%E5%BC%82%E5%B8%B8%E7%9A%84%E7%B1%BB%E5%88%AB"><span class="toc-number">2.2.</span> <span class="toc-text">8.1.2 异常的类别</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-1%E3%80%81%E4%B8%AD%E6%96%AD"><span class="toc-number">2.2.1.</span> <span class="toc-text">8.1.2.1、中断</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-2%E3%80%81%E9%99%B7%E9%98%B1%E5%92%8C%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">2.2.2.</span> <span class="toc-text">8.1.2.2、陷阱和系统调用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-3%E3%80%81%E6%95%85%E9%9A%9C"><span class="toc-number">2.2.3.</span> <span class="toc-text">8.1.2.3、故障</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-4%E3%80%81%E7%BB%88%E6%AD%A2"><span class="toc-number">2.2.4.</span> <span class="toc-text">8.1.2.4、终止</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-3-Linux%E4%B8%AD%E7%9A%84%E5%BC%82%E5%B8%B8"><span class="toc-number">2.3.</span> <span class="toc-text">8.1.3 Linux中的异常</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-1-%E6%95%85%E9%9A%9C%E5%92%8C%E7%BB%88%E6%AD%A2"><span class="toc-number">2.3.1.</span> <span class="toc-text">8.1.3.1 故障和终止</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-2-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="toc-number">2.3.2.</span> <span class="toc-text">8.1.3.2 系统调用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E8%BF%9B%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">8.2 进程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E9%80%BB%E8%BE%91%E6%8E%A7%E5%88%B6%E6%B5%81"><span class="toc-number">3.0.1.</span> <span class="toc-text">8.2.1 逻辑控制流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E5%B9%B6%E5%8F%91%E6%B5%81"><span class="toc-number">3.0.2.</span> <span class="toc-text">8.2.2 并发流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-3-%E7%A7%81%E6%9C%89%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4"><span class="toc-number">3.0.3.</span> <span class="toc-text">8.2.3 私有地址空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-4-%E7%94%A8%E6%88%B7%E6%A8%A1%E5%BC%8F%E5%92%8C%E5%86%85%E6%A0%B8%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.0.4.</span> <span class="toc-text">8.2.4 用户模式和内核模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-5-%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2"><span class="toc-number">3.0.5.</span> <span class="toc-text">8.2.5 上下文切换</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">8.3 系统调用错误处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-4-%E8%BF%9B%E7%A8%8B%E6%8E%A7%E5%88%B6"><span class="toc-number">5.</span> <span class="toc-text">8.4 进程控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-1-%E8%8E%B7%E5%8F%96%E8%BF%9B%E7%A8%8BID"><span class="toc-number">5.1.</span> <span class="toc-text">8.4.1 获取进程ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-2-%E5%88%9B%E5%BB%BA%E5%92%8C%E7%BB%88%E6%AD%A2%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.2.</span> <span class="toc-text">8.4.2 创建和终止进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-3-%E5%9B%9E%E6%94%B6%E5%AD%90%E8%BF%9B%E7%A8%8B"><span class="toc-number">5.3.</span> <span class="toc-text">8.4.3 回收子进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-4-%E8%AE%A9%E8%BF%9B%E7%A8%8B%E4%BC%91%E7%9C%A0"><span class="toc-number">5.4.</span> <span class="toc-text">8.4.4 让进程休眠</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-5-%E5%8A%A0%E8%BD%BD%E5%B9%B6%E8%BF%90%E8%A1%8C%E7%A8%8B%E5%BA%8F"><span class="toc-number">5.5.</span> <span class="toc-text">8.4.5 加载并运行程序</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-5-%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.</span> <span class="toc-text">8.5 信号</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-1-%E4%BF%A1%E5%8F%B7%E6%9C%AF%E8%AF%AD"><span class="toc-number">6.1.</span> <span class="toc-text">8.5.1 信号术语</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-2-%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.</span> <span class="toc-text">8.5.2 发送信号</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-1-%E8%BF%9B%E7%A8%8B%E7%BB%84"><span class="toc-number">6.2.1.</span> <span class="toc-text">8.5.2.1 进程组</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-2-%E7%94%A8-bin-kill%E7%A8%8B%E5%BA%8F%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.2.</span> <span class="toc-text">8.5.2.2 用&#x2F;bin&#x2F;kill程序发送信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-3-%E4%BB%8E%E9%94%AE%E7%9B%98%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.3.</span> <span class="toc-text">8.5.2.3 从键盘发送信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-4-%E7%94%A8kill%E5%87%BD%E6%95%B0%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.4.</span> <span class="toc-text">8.5.2.4 用kill函数发送信号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-5-alarm%E5%8F%91%E9%80%81%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.2.5.</span> <span class="toc-text">8.5.2.5 alarm发送信号</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-3-%E6%8E%A5%E6%94%B6%E4%BF%A1%E5%8F%B7"><span class="toc-number">6.3.</span> <span class="toc-text">8.5.3 接收信号</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&text=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&is_video=false&description=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=CSAPP深入理解计算机系统-第八章-异常控制流&body=Check out this article: http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&title=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&name=CSAPP深入理解计算机系统-第八章-异常控制流&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/2025/01/06/csapp/CSAPP%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F-%E7%AC%AC%E5%85%AB%E7%AB%A0-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81/&t=CSAPP深入理解计算机系统-第八章-异常控制流"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2025
    BoBoDai
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/BoBoDai">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
